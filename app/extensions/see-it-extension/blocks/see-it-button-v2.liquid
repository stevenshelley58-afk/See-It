{% schema %}
{
  "name": "See It Button V2",
  "target": "section",
  "stylesheet": "see-it-v2.css",
  "javascript": "see-it-v2.js",
  "templates": ["product"],
  "settings": [
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "See it in your room"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button Style",
      "options": [
        { "value": "primary", "label": "Primary" },
        { "value": "secondary", "label": "Secondary" }
      ],
      "default": "primary"
    }
  ]
}
{% endschema %}

{% if product != blank and product.featured_image != blank %}
  {% assign product_image_url = product.featured_image | image_url: width: 800 %}
  {% assign product_title = product.title | default: "Product" %}
  {% assign product_price = product.price | money %}
  {% assign product_collection = product.collections.first.handle | default: '' %}

  {% assign btn_class = 'see-it-v2-btn-primary-pill' %}
  {% if block.settings.button_style == 'secondary' %}
    {% assign btn_class = 'see-it-v2-btn-outline-pill' %}
  {% endif %}

  <!-- V2 Widget Container -->
  <div class="see-it-v2-widget-hook">
    <div class="see-it-v2-widget-content">
      <div class="see-it-v2-widget-text">
        <span class="see-it-v2-widget-title">Try it in Your Home</span>
        <span class="see-it-v2-widget-description">AI creates 4 room visualizations instantly.</span>
      </div>
    </div>

    <button
      id="see-it-v2-trigger"
      class="{{ btn_class }}"
      data-product-id="{{ product.id }}"
      data-product-handle="{{ product.handle }}"
      data-product-image="{{ product_image_url }}"
      data-product-title="{{ product_title | escape }}"
      data-product-price="{{ product_price | escape }}"
      data-product-collection="{{ product_collection }}"
      data-shop-domain="{{ shop.domain }}"
      type="button"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2 L22 7 L22 17 L12 22 L2 17 L2 7 Z"/>
        <path d="M12 2 L12 22"/>
        <path d="M22 7 L12 12 L2 7"/>
      </svg>
      {{ block.settings.button_label | default: "See it in your room" }}
    </button>
  </div>

  <!-- V2 Modal -->
  <div id="see-it-v2-modal" class="see-it-v2-modal hidden">
    <div class="see-it-v2-modal-content">
      <div id="see-it-v2-global-error" class="see-it-v2-hidden"></div>

      <!-- ENTRY SCREEN -->
      <div id="see-it-v2-screen-entry" class="see-it-v2-screen see-it-v2-screen-entry active">
        <div class="see-it-v2-header">
          <button class="see-it-v2-btn-icon" id="see-it-v2-close-entry" aria-label="Close">
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
          <div class="see-it-v2-header-spacer"></div>
        </div>

        <div class="see-it-v2-entry-content">
          <div class="see-it-v2-product-card-compact">
            <img src="{{ product_image_url }}" alt="">
            <div class="see-it-v2-product-info-compact">
              <p class="see-it-v2-product-title-compact">{{ product_title }}</p>
            </div>
          </div>

          <h1 class="see-it-v2-entry-title">See it in your space</h1>
          <p class="see-it-v2-entry-description">Upload a room photo and AI will create 4 placement options for you to choose from.</p>

          <div class="see-it-v2-entry-actions">
            <button class="see-it-v2-btn-primary-pill" id="see-it-v2-btn-take-photo">
              <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"/><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z"/></svg>
              Take Photo
            </button>
            <button class="see-it-v2-btn-outline-pill" id="see-it-v2-btn-upload">Upload</button>
          </div>
        </div>
      </div>

      <!-- GENERATING SCREEN (V2 specific) -->
      <div id="see-it-v2-screen-generating" class="see-it-v2-screen see-it-v2-screen-generating">
        <div class="see-it-v2-header">
          <button class="see-it-v2-btn-icon" id="see-it-v2-back-generating" aria-label="Back">
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <div class="see-it-v2-header-spacer"></div>
        </div>

        <div class="see-it-v2-generating-content">
          <div class="see-it-v2-generating-product">
            <img id="see-it-v2-generating-product-img" src="{{ product_image_url }}" alt="{{ product_title }}">
          </div>

          <h2 class="see-it-v2-generating-title">Creating 4 placements<span class="see-it-v2-loading-dots"></span></h2>
          <p class="see-it-v2-generating-subtitle">AI is finding the best spots in your room</p>

          <div class="see-it-v2-generating-grid">
            <div class="see-it-v2-generating-cell">
              <div class="see-it-v2-generating-shimmer"></div>
              <span class="see-it-v2-generating-label">Open space</span>
            </div>
            <div class="see-it-v2-generating-cell">
              <div class="see-it-v2-generating-shimmer"></div>
              <span class="see-it-v2-generating-label">Wall side</span>
            </div>
            <div class="see-it-v2-generating-cell">
              <div class="see-it-v2-generating-shimmer"></div>
              <span class="see-it-v2-generating-label">Near light</span>
            </div>
            <div class="see-it-v2-generating-cell">
              <div class="see-it-v2-generating-shimmer"></div>
              <span class="see-it-v2-generating-label">Corner</span>
            </div>
          </div>

          <p class="see-it-v2-generating-tip" id="see-it-v2-generating-tip">Tip: Good lighting makes the best visualizations</p>
        </div>
      </div>

      <!-- SELECT SCREEN (V2 specific) -->
      <div id="see-it-v2-screen-select" class="see-it-v2-screen see-it-v2-screen-select">
        <div class="see-it-v2-header">
          <button class="see-it-v2-btn-icon" id="see-it-v2-back-select" aria-label="Back">
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <span class="see-it-v2-header-title">Choose your favorite</span>
          <div class="see-it-v2-header-spacer"></div>
        </div>

        <div class="see-it-v2-select-content">
          <div class="see-it-v2-select-grid">
            <button class="see-it-v2-select-cell" data-variant="open">
              <img src="" alt="Open space placement" id="see-it-v2-variant-open">
              <span class="see-it-v2-select-label">Open space</span>
              <div class="see-it-v2-select-check">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
              </div>
            </button>
            <button class="see-it-v2-select-cell" data-variant="wall">
              <img src="" alt="Wall side placement" id="see-it-v2-variant-wall">
              <span class="see-it-v2-select-label">Wall side</span>
              <div class="see-it-v2-select-check">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
              </div>
            </button>
            <button class="see-it-v2-select-cell" data-variant="light">
              <img src="" alt="Near light placement" id="see-it-v2-variant-light">
              <span class="see-it-v2-select-label">Near light</span>
              <div class="see-it-v2-select-check">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
              </div>
            </button>
            <button class="see-it-v2-select-cell" data-variant="corner">
              <img src="" alt="Corner placement" id="see-it-v2-variant-corner">
              <span class="see-it-v2-select-label">Corner</span>
              <div class="see-it-v2-select-check">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
              </div>
            </button>
          </div>
        </div>

        <div class="see-it-v2-select-footer">
          <button class="see-it-v2-btn-text" id="see-it-v2-fallback-v1">
            None of these work? Try detailed mode
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
          </button>
        </div>
      </div>

      <!-- RESULT SCREEN -->
      <div id="see-it-v2-screen-result" class="see-it-v2-screen see-it-v2-screen-result">
        <div class="see-it-v2-header">
          <button class="see-it-v2-btn-icon" id="see-it-v2-back-result" aria-label="Back">
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <div style="flex:1"></div>
          <button class="see-it-v2-btn-icon" id="see-it-v2-close-result" aria-label="Close">
            <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>

        <div class="see-it-v2-result-container">
          <img id="see-it-v2-result-image" src="" alt="Your visualization">
        </div>

        <div class="see-it-v2-result-actions">
          <button class="see-it-v2-btn-primary-pill" id="see-it-v2-share">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
            Share
          </button>
          <div class="see-it-v2-result-secondary">
            <button class="see-it-v2-btn-text" id="see-it-v2-try-again">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              Try Again
            </button>
            <button class="see-it-v2-btn-text" id="see-it-v2-try-another">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
              Try Another Product
            </button>
          </div>
        </div>

        <div class="see-it-v2-disclaimer">
          AI visualizations are approximations. Product scale, colour, and placement are indicative.
        </div>

        <div class="see-it-v2-version-badge">v2.0</div>
      </div>

      <!-- Hidden File Inputs -->
      <input type="file" id="see-it-v2-upload-input" accept="image/*" style="display: none;">
      <input type="file" id="see-it-v2-camera-input" accept="image/*" capture="environment" style="display: none;">
    </div>
  </div>
{% endif %}
